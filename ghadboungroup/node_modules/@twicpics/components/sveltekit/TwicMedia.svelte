
<script context="module">import {
  parseClassName,
  parseMediaTag
} from "./_utils.js";
import {
  computeAlt,
  computeData,
  computePlaceholderStyle,
  computeStyle,
  computeWrapperClass,
  computeWrapperStyle,
  isBrowser,
  Observer,
  parseAlt,
  parseAnchor,
  parseBot,
  parseFocus,
  parseIntrinsic,
  parseMode,
  parseEager,
  parsePlaceholder,
  parsePosition,
  parsePreTransform,
  parseRatio,
  parseRefit,
  parseSrc,
  parseStep,
  parseTitle,
  parseTransition,
  parseTransitionDelay,
  parseTransitionDuration,
  parseTransitionTimingFunction,
  preComputePlaceholder,
  styleToString
} from "./_utils.js";
import { createEventDispatcher, onDestroy, onMount } from "svelte";
</script>

<script>export let alt = void 0;
export let anchor = void 0;
export let bot = void 0;
let className = void 0;
export { className as class };
export let focus = void 0;
export let intrinsic = void 0;
export let media = void 0;
export let mediaTag = `img`;
export let mode = void 0;
export let eager = false;
export let placeholder = void 0;
export let position = void 0;
export let preTransform = void 0;
export let ratio = void 0;
export let refit = void 0;
export let src;
export let step = void 0;
export let state = void 0;
export let title = void 0;
export let transition = void 0;
export let transitionDelay = void 0;
export let transitionDuration = void 0;
export let transitionTimingFunction = void 0;
export let videoOptions = void 0;
const observer = new Observer((_state) => {
  state = _state;
});
const stateDispatcher = createEventDispatcher();
$:
  stateDispatcher(`statechange`, { state });
$:
  parsedAlt = parseAlt(alt);
$:
  parsedAnchor = parseAnchor(anchor);
$:
  parsedBot = parseBot(bot);
$:
  parsedClassName = parseClassName(className) || ``;
$:
  parsedEager = parseEager(eager);
$:
  parsedFocus = parseFocus(focus);
$:
  parsedIntrinsic = parseIntrinsic(intrinsic);
$:
  parsedMediaTag = parseMediaTag(mediaTag);
$:
  parsedMode = parseMode(mode);
$:
  parsedPlaceholder = parsePlaceholder(placeholder);
$:
  parsedPosition = parsePosition(position);
$:
  parsedPreTransform = parsePreTransform(preTransform);
$:
  parsedRatio = parseRatio(ratio);
$:
  parsedRefit = parseRefit(refit);
$:
  parsedSrc = parseSrc(src);
$:
  parsedStep = parseStep(step);
$:
  parsedTitle = parseTitle(title);
$:
  parsedTransition = parseTransition(transition);
$:
  parsedTransitionDelay = parseTransitionDelay(transitionDelay);
$:
  parsedTransitionDuration = parseTransitionDuration(transitionDuration);
$:
  parsedTransitionTimingFunction = parseTransitionTimingFunction(transitionTimingFunction);
$:
  parsedVideoOptions = videoOptions;
$:
  parsedPlaceholder_ = preComputePlaceholder(parsedPlaceholder, parsedSrc);
$:
  _alt = computeAlt(parsedAlt, parsedMediaTag);
$:
  _data = computeData(
    parsedAnchor,
    parsedBot,
    parsedEager,
    parsedFocus,
    parsedIntrinsic,
    parsedMediaTag,
    parsedMode,
    parsedPreTransform,
    parsedRefit,
    parsedSrc,
    parsedStep,
    parsedVideoOptions
  );
$:
  _placeholderStyle = styleToString(computePlaceholderStyle(
    parsedAnchor,
    parsedFocus,
    parsedMode,
    parsedPlaceholder_,
    parsedPosition,
    parsedPreTransform,
    parsedRatio,
    parsedRefit,
    parsedSrc,
    parsedTransition,
    parsedTransitionDelay,
    parsedTransitionDuration,
    parsedTransitionTimingFunction,
    parsedVideoOptions,
    observer.setPlaceholderData
  ));
$:
  _style = styleToString(computeStyle(
    parsedAnchor,
    parsedMediaTag,
    parsedMode,
    parsedPosition,
    parsedTransitionDelay,
    parsedTransitionDuration,
    parsedTransitionTimingFunction
  ));
$:
  _wrapperStyle = styleToString(computeWrapperStyle(parsedRatio));
if (isBrowser) {
  onMount(() => {
    observer.setMedia(media);
  });
  onDestroy(() => {
    observer.destroy();
  });
}
</script>
<div
    class = { computeWrapperClass( parsedClassName, src, parsedTransition ) }
    style = { _wrapperStyle }
    title = { parsedTitle }
>
    <svelte:element this={ mediaTag }
        bind:this = { media }
        alt = { _alt }
        style = { _style }
        { ..._data }
    ></svelte:element>
    {#if parsedPlaceholder_ }
        <div style = { _placeholderStyle } />
    {/if}
</div>
