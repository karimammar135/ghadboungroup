const e=t=>{if(!t)return;const{attributes:o,element:n,elementName:s,value:a}=t,i=n||document.createElement(s||"div");if(o&&i instanceof HTMLElement)for(const[e,t]of Object.entries(o))i.setAttribute(e,String(t));if(a)if("string"==typeof a)i.innerHTML=a;else for(const t of Array.isArray(a)?a:[a]){const o=e(t);o&&i.appendChild(o)}return i},t="undefined"!=typeof document,o=()=>{},n=e=>{throw new Error((e=>`twicpics-components ${e}`)(e))},s=(e,{border:t="\\s",regExpFlags:o}={})=>new RegExp(`^(?:${t})*(${Array.isArray(e)?e.join("|"):e})(?:${t})*$`,o),a={breakpoints:{xs:320,sm:640,md:768,lg:1024,xl:1280,"2xl":1536},class:"twic",domain:void 0,env:"production",handleShadowDom:o,maxDPR:void 0,path:"",step:void 0},i=t&&window,r=t?i["~ TPCC"]||(i["~ TPCC"]=a):a,c=/^(?:(auth|placeholder|rel)|(image|media|video)|[^:]*):(\/*)((v[0-9]+(?=[/?]))?[^?]*(\?.*)?)$/,d=(e,t="")=>{const o=e&&c.exec(e);return{isAbsolute:e.slice(0,t.length+1)===`${t}/`,isSpecial:o&&void 0!==o[1]}},l=({domain:e,context:t,inspect:o,output:n,quality:s,src:a,transform:i})=>{const{isAbsolute:r}=d(a,e),l=r?`media:${a.slice(`${e}/`.length)}`:a,p=c.exec(l),m=p&&p[2],$=n?`/output=${n}`:"",u=m?p[4]:l,h=s?`/quality=${s}`:"",f=o?"/inspect":"",w=(({height:e,mode:t,width:o},n)=>{if(n&&(o||e)){const s=e||"-",a=o||"-";return n.replace(/(\/*\*)/g,`/${t}=${a}x${s}`).replace(/WxH/g,`${a}x${s}`)}return n})(t,i);return`${e}/${p&&(p[1]||p[5])?`v1${w}${$}${h}${f}/${m?`${p[2]}:${u}`:u}`:`${u}${p&&p[6]?"&":"?"}twic=v1${w}${$}${f}${h}`}`},p=["center"];for(const e of["","bottom","top"])for(const t of["","left","right"])(t||e)&&p.push(e?t?`${e}-${t}`:e:t);const m=/\?|^\/*$/;s(p);const $=/(^https?:\/\/[^/]+)\/*$/;s(["high","low","auto"]),s("\\s*(\\d+)\\s*[x]\\s*(\\d+)\\s*"),s(["contain","cover"]),s(["maincolor","meancolor","none","preview"]);const u=/^\/*(.+?)\/*$/;s("(\\d+(?:\\.\\d+)?)(?:\\s*[\\/:]\\s*(\\d+(?:\\.\\d+)?))?|(none)");const h=s(["debug","offline","production"]);s("(\\d+\\.?\\d*)|(css)",{regExpFlags:"i"});const f=/^((image|media|video):)?\/*/,w=((e,{filter:t,defaultValue:o}={})=>n=>{let s;return n&&`${n}`.replace(e,((e,t)=>s=t)),(t?t(s):s)||o})(s("(?:.|\n)+?"));s(".+?",{border:"[\\s\\/]"});const v=e=>{if("offline"===r.env)return"";const t=w(e)||"placeholder:red",{isAbsolute:o,isSpecial:n}=d(t,r.domain);return n?t:o?`media:${t.slice(`${r.domain}/`.length)}`:t.replace(f,`media:${r.path}`)};var g=({src:e,width:t,quality:o})=>l({context:{mode:"resize",width:t},domain:r.domain,quality:o,src:v(e),transform:"*"}),b=async e=>{const t=await fetch(l({context:{mode:"resize",width:1e3},domain:r.domain,output:"preview",src:v(e),transform:"*"})),o=await t.arrayBuffer();return`data:${t.headers.get("content-type")};base64,${Buffer.from(o).toString("base64")}`};(e=>{e||n("install options not provided");const{domain:t,env:o,path:s}=e;t&&$.test(t)||n(`install domain "${t}" is invalid`),s&&m.test(s)&&n(`install path "${s}" is invalid`),o&&!h.test(o)&&n(`install env "${o}" is invalid`)})({domain:process.env.NEXT_PUBLIC_TWICPICS_DOMAIN,path:process.env.NEXT_PUBLIC_TWICPICS_PATH}),(n=>{const{breakpoints:s={},debug:a,domain:i,class:c,env:d,handleShadowDom:l,maxDPR:p,path:m}=n;r.breakpoints=Object.assign(Object.assign({},r.breakpoints),s),r.class=c||r.class,r.domain=i,r.env=a?"debug":d,r.maxDPR=Math.max(1,p||2),r.path=m,r.handleShadowDom=l&&t?(t=>{const o=new WeakSet;return n=>{for(;n&&!o.has(n);){o.add(n);const{parentNode:s}=n;if(!s&&n instanceof ShadowRoot){if("closed"===n.mode)throw new Error("cannot use TwicPics components in closed ShadowRoot");e({element:n,value:{elementName:"style",value:`*STYLE*.twic-w>.${r.class}-background-done+div,.twic-w>.${r.class}-done+div,.twic-w>.${r.class}-poster-done+div{opacity:0 !important}.twic-w>.${r.class}-done,.twic-w>.${r.class}-poster-done{transform:none !important}`}}),(n=n.host)&&n.setAttribute(t,"")}else n=s}}})(`data-${r.class}-component`):o})({domain:(e=>{const t=w(e);return $.test(t)?t.replace($,"$1"):void 0})(process.env.NEXT_PUBLIC_TWICPICS_DOMAIN),path:(e=>{const t=w(e);return t?t.replace(u,"$1/"):""})(process.env.NEXT_PUBLIC_TWICPICS_PATH)});export{g as twicpicsLoader,b as twicpicsPlaceholder};
//# sourceMappingURL=module.mjs.map
